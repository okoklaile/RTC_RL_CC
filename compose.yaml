services:
  receiver:
    image: pyrtc_image:latest
    privileged: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1          # 使用 1 张显卡
              capabilities: [gpu]
    volumes:
      - ./share:/app/share
    container_name: rtc_c2
    user: "user"
    environment:
      ARG_A: "${ARG_A:-dummy}"
      FARC_DEBUG: "${FARC_DEBUG:-0}"  # 调试模式，设置为 1 启用
      SCHAFERCT_DEBUG: "${SCHAFERCT_DEBUG:-0}"  # Schaferct 调试模式
    command: python run.py -A "${ARG_A:-dummy}"
    networks:
      rtcnet:
        ipv4_address: 192.168.2.102
  
  sender:
    image: pyrtc_image:latest
    privileged: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1          # 使用 1 张显卡
              capabilities: [gpu]
    volumes:
      - ./share:/app/share
    container_name: rtc_c1
    depends_on:
      - receiver
    user: "user"
    environment:
      ARG_A: "${ARG_A:-dummy}"
      FARC_DEBUG: "${FARC_DEBUG:-0}"  # 调试模式，设置为 1 启用
      SCHAFERCT_DEBUG: "${SCHAFERCT_DEBUG:-0}"  # Schaferct 调试模式
    command: ["/bin/bash", "entrypoint_sender.sh"]
    networks:
      rtcnet:
        ipv4_address: 192.168.2.101

networks:
  rtcnet:
    external: true
